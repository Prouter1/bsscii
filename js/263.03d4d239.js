"use strict";(self["webpackChunkfans_indexer_web"]=self["webpackChunkfans_indexer_web"]||[]).push([[263],{6263:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var a=n(6252),i=n(3577),s=n(2262),r=n(9996),l=n(5659),o=n(4708),p=n(3481),u=n(5121),d=n(381),c=n.n(d),y=n(2201),m=n(4960),g=n(3555),v=n(4579);const _={style:{width:"80vw",margin:"0 auto 50px",background:"#fff",border:"1px solid #ddd",padding:"30px"}},w={style:{"padding-bottom":"10px"}},f={style:{display:"flex","justify-content":"flex-end","margin-bottom":"10px"}},b=["href"],h=["href"],x=["href"],T=["href"],k={style:{display:"flex","justify-content":"center","margin-top":"30px"}},M={style:{"margin-bottom":"10px"}},S={class:"dialog-footer"},U=(0,a._)("div",{style:{"margin-bottom":"10px"}},"Are you sure you want to cancel this order?",-1),C={class:"dialog-footer"};var H={__name:"Market",setup(e){const t=(0,m.o)(),n=(0,y.tv)(),d=(0,s.iH)(1),H=(0,s.iH)(10),B=(0,s.iH)([]),z=(0,s.iH)(0),I=(0,s.iH)(!1),Y=(0,s.iH)(!1),A=(0,s.iH)(""),O=(0,s.iH)(""),E=(0,s.iH)({}),D=(0,s.iH)(!1),W=(0,s.iH)(!1),P=(0,s.iH)(!1),j=(0,s.iH)(!1),L=async()=>{I.value=!0;let e="https://fansgo.xyz/api/v1/market/orders?page_size="+H.value+"&page="+d.value;await u.Z.get(e).then((e=>{const t=e.data;if(0!==t.code)return void(0,r.bM)({title:"Error",message:t.error,offset:80});z.value=t.data.total_count;let n=[];t.data.orders.forEach((e=>{e.s_start_time=c()(1e3*e.started_at).format("YYYY-MM-DD HH:mm:ss"),e.s_end_time=c()(1e3*e.expired_at).format("YYYY-MM-DD HH:mm:ss"),e.inscription_id="#"+e.inscription_id,e.s_amount=BigInt(e.amount).toLocaleString("en-US"),e.maker=e.signer.slice(0,7)+"..."+e.signer.slice(-5),console.log(e.expired_at<Date.now()/1e3),e.s_is_expired=e.expired_at<Date.now()/1e3,n.push({...e})})),B.value=n,console.log(n)})).catch((e=>{console.log(e),(0,r.bM)({title:"Error",message:e,offset:80})})),I.value=!1},N=async e=>{I.value=!0;let t="https://fansgo.xyz/api/v1/market/orders?page_size="+H.value+"&page="+d.value;e&&(t=t+"&owner="+e),await u.Z.get(t).then((e=>{const t=e.data;if(0!==t.code)return void(0,r.bM)({title:"Error",message:t.error,offset:80});z.value=t.data.total_count;let n=[];t.data.orders.forEach((e=>{e.s_start_time=c()(1e3*e.started_at).format("YYYY-MM-DD HH:mm:ss"),e.s_end_time=c()(1e3*e.expired_at).format("YYYY-MM-DD HH:mm:ss"),e.inscription_id="#"+e.inscription_id,e.s_amount=BigInt(e.amount).toLocaleString("en-US"),e.maker=e.signer.slice(0,7)+"..."+e.signer.slice(-5),e.s_is_expired=e.expired_at<Date.now()/1e3,n.push({...e})})),B.value=n,console.log(n)})).catch((e=>{console.log(e),(0,r.bM)({title:"Error",message:e,offset:80})})),I.value=!1},V=async e=>{I.value=!0;let t="https://fansgo.xyz/api/v1/market/orders?page_size="+H.value+"&page="+d.value+"&status="+e;await u.Z.get(t).then((e=>{const t=e.data;if(0!==t.code)return void(0,r.bM)({title:"Error",message:t.error,offset:80});z.value=t.data.total_count;let n=[];t.data.orders.forEach((e=>{e.s_start_time=c()(1e3*e.started_at).format("YYYY-MM-DD HH:mm:ss"),e.s_end_time=c()(1e3*e.expired_at).format("YYYY-MM-DD HH:mm:ss"),e.inscription_id="#"+e.inscription_id,e.s_amount=BigInt(e.amount).toLocaleString("en-US"),e.maker=e.signer.slice(0,7)+"..."+e.signer.slice(-5),e.s_is_expired=e.expired_at<Date.now()/1e3,e.s_exec_time=c()(1e3*e.exec_time).format("YYYY-MM-DD HH:mm:ss"),n.push({...e})})),B.value=n,console.log(n)})).catch((e=>{console.log(e),(0,r.bM)({title:"Error",message:e,offset:80})})),I.value=!1};(0,a.bv)((()=>{L()}));const X=async e=>{null!==t.selectedAddress?(Y.value=!0,A.value=e.s_amount,O.value=e.price_eth,E.value={signer:e.signer,inscription_id:e.inscription_hash,price:e.price,nonce:e.nonce,started_at:e.started_at,expired_at:e.expired_at,signature:e.signature}):alert("Please connect wallet")},q=async e=>{null!==t.selectedAddress?(D.value=!0,E.value={signer:e.signer,inscription_id:e.inscription_hash,price:e.price,nonce:e.nonce,started_at:e.started_at,expired_at:e.expired_at,signature:e.signature}):alert("Please connect wallet")},F=async()=>{if(W.value)return;W.value=!0;const e=new window.w3ProviderInstance.eth.Contract(v.H,v.X);try{const n=e.methods.executeInscriptionOrder({signer:E.value.signer,inscriptionId:E.value.inscription_id,price:E.value.price,nonce:E.value.nonce,startedAt:E.value.started_at,expiredAt:E.value.expired_at,signature:E.value.signature},t.selectedAddress).encodeABI();console.log("calldata",n),await J(v.X,E.value.price,n),W.value=!1}catch(n){console.log(n),W.value=!1}Y.value=!1,E.value={}},G=async()=>{if(W.value)return;W.value=!0;const e=new window.w3ProviderInstance.eth.Contract(v.H,v.X);try{const t=e.methods.cancelOrder({signer:E.value.signer,inscriptionId:E.value.inscription_id,price:E.value.price,nonce:E.value.nonce,startedAt:E.value.started_at,expiredAt:E.value.expired_at,signature:E.value.signature}).encodeABI();await J(v.X,0,t),W.value=!1}catch(t){console.log(t),W.value=!1}D.value=!1,E.value={}},R=()=>{null!==t.selectedAddress?n.push({path:"/inscription",query:{owner:t.selectedAddress}}):alert("Please connect wallet")},Z=async()=>{null!==t.selectedAddress?(d.value=1,P.value=!1,j.value=!0,await N(t.selectedAddress)):alert("Please connect wallet")},Q=async()=>{d.value=1,P.value=!0,j.value=!1,await V("sale")},$=async()=>{d.value=1,P.value=!1,j.value=!1,await L()},J=async(e,n,a)=>{if(!window.ethereum)return;console.log("value",n);const i={from:t.selectedAddress,to:e,value:n,data:a};try{await window.providerInstance.estimateGas(i)}catch(s){return console.log(s),(0,r.bM)({title:"Error",message:"Simulated transaction failed",type:"error",offset:80}),void setTimeout((()=>{L()}),1e3)}try{let i=await window.ethereum.request({method:"eth_sendTransaction",params:[{from:t.selectedAddress,to:e,value:BigInt(n).toString(16),data:a}]});(0,g.M)(i),console.log("txHash",i)}catch(s){console.log(s)}};return(e,n)=>{const r=(0,a.up)("el-table-column"),u=(0,a.up)("el-pagination"),c=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",_,[(0,a._)("div",w,"List Count: "+(0,i.zw)(z.value),1),(0,a._)("div",f,[(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:$},{default:(0,a.w5)((()=>[(0,a.Uk)("All Orders")])),_:1}),(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:Q},{default:(0,a.w5)((()=>[(0,a.Uk)("Sold Orders")])),_:1}),(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:Z},{default:(0,a.w5)((()=>[(0,a.Uk)("My Orders")])),_:1}),(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:R},{default:(0,a.w5)((()=>[(0,a.Uk)(" List ")])),_:1})]),(0,a.wy)(((0,a.wg)(),(0,a.j4)((0,s.SU)(o.eI),{stripe:"",data:B.value,style:{width:"100%","font-size":"13px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{prop:"inscription_id",label:"Inscriptions",width:"110"},{default:(0,a.w5)((e=>[(0,a._)("a",{href:"https://bscscan.com/tx/"+e.row.inscription_hash,target:"_blank"},"#0",8,b)])),_:1}),(0,a.Wm)(r,{prop:"maker",label:"Maker"},{default:(0,a.w5)((e=>[e.row.signer===(0,s.SU)(t).selectedAddress?((0,a.wg)(),(0,a.iD)("a",{key:0,href:"https://bscscan.com/address/"+e.row.signer,target:"_blank"},"You",8,h)):((0,a.wg)(),(0,a.iD)("a",{key:1,href:"https://bscscan.com/address/"+e.row.signer,target:"_blank"},(0,i.zw)(e.row.maker),9,x))])),_:1}),(0,a.Wm)(r,{prop:"s_amount",label:"Amount"}),(0,a.Wm)(r,{prop:"page_price_usd",label:"Price/USD(10^8)",width:"145"}),(0,a.Wm)(r,{prop:"price_eth",label:"Total/BNB",width:"143"}),(0,a.Wm)(r,{prop:"price_usd",label:"Total/USD",width:"143"}),P.value?((0,a.wg)(),(0,a.j4)(r,{key:1,prop:"s_exec_time",label:"Sold Time"})):((0,a.wg)(),(0,a.j4)(r,{key:0,prop:"s_end_time",label:"Close Time"})),P.value?((0,a.wg)(),(0,a.j4)(r,{key:3,label:"Explorer"},{default:(0,a.w5)((e=>[(0,a._)("a",{href:"https://bscscan.com/tx/"+e.row.exec_tx_hash,target:"_blank"},"BNBScan",8,T)])),_:1})):((0,a.wg)(),(0,a.j4)(r,{key:2,label:"Operation"},{default:(0,a.w5)((e=>[e.row.s_is_expired||e.row.signer===(0,s.SU)(t).selectedAddress?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)((0,s.SU)(l.ElButton),{key:0,color:"#e94142",onClick:t=>X(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("Buy ")])),_:2},1032,["onClick"])),e.row.signer===(0,s.SU)(t).selectedAddress?((0,a.wg)(),(0,a.j4)((0,s.SU)(l.ElButton),{key:1,onClick:t=>q(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("Cancel ")])),_:2},1032,["onClick"])):(0,a.kq)("",!0)])),_:1}))])),_:1},8,["data"])),[[c,I.value]]),(0,a._)("div",k,[P.value?((0,a.wg)(),(0,a.j4)(u,{key:0,background:"","current-page":d.value,"onUpdate:currentPage":n[0]||(n[0]=e=>d.value=e),"page-size":H.value,"onUpdate:pageSize":n[1]||(n[1]=e=>H.value=e),"page-sizes":[10,20,50,100],"default-page-size":10,onSizeChange:n[2]||(n[2]=e=>V("sale")),onCurrentChange:n[3]||(n[3]=e=>V("sale")),layout:"prev, pager, next, sizes",total:z.value},null,8,["current-page","page-size","total"])):j.value?((0,a.wg)(),(0,a.j4)(u,{key:1,background:"","current-page":d.value,"onUpdate:currentPage":n[4]||(n[4]=e=>d.value=e),"page-size":H.value,"onUpdate:pageSize":n[5]||(n[5]=e=>H.value=e),"page-sizes":[10,20,50,100],"default-page-size":10,onSizeChange:n[6]||(n[6]=e=>N((0,s.SU)(t).selectedAddress)),onCurrentChange:n[7]||(n[7]=e=>N((0,s.SU)(t).selectedAddress)),layout:"prev, pager, next, sizes",total:z.value},null,8,["current-page","page-size","total"])):((0,a.wg)(),(0,a.j4)(u,{key:2,background:"","current-page":d.value,"onUpdate:currentPage":n[8]||(n[8]=e=>d.value=e),"page-size":H.value,"onUpdate:pageSize":n[9]||(n[9]=e=>H.value=e),"page-sizes":[10,20,50,100],"default-page-size":10,onSizeChange:L,onCurrentChange:L,layout:"prev, pager, next, sizes",total:z.value},null,8,["current-page","page-size","total"]))])]),(0,a.Wm)((0,s.SU)(p.d0),{modelValue:Y.value,"onUpdate:modelValue":n[11]||(n[11]=e=>Y.value=e),title:"Buy Inscriptions",style:{width:"600px"}},{footer:(0,a.w5)((()=>[(0,a._)("span",S,[(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:n[10]||(n[10]=e=>Y.value=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("Cancel")])),_:1}),(0,a.Wm)((0,s.SU)(l.ElButton),{type:"primary",onClick:F},{default:(0,a.w5)((()=>[(0,a.Uk)(" Buy ")])),_:1})])])),default:(0,a.w5)((()=>[(0,a._)("div",M,"You will cost "+(0,i.zw)(O.value)+"BNB to buy "+(0,i.zw)(A.value.toLocaleString("en-US"))+" $OPBS ",1)])),_:1},8,["modelValue"]),(0,a.Wm)((0,s.SU)(p.d0),{modelValue:D.value,"onUpdate:modelValue":n[13]||(n[13]=e=>D.value=e),title:"Cancel Inscriptions Order",style:{width:"600px"}},{footer:(0,a.w5)((()=>[(0,a._)("span",C,[(0,a.Wm)((0,s.SU)(l.ElButton),{onClick:n[12]||(n[12]=e=>D.value=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("Cancel")])),_:1}),(0,a.Wm)((0,s.SU)(l.ElButton),{type:"primary",onClick:G},{default:(0,a.w5)((()=>[(0,a.Uk)(" Confirm ")])),_:1})])])),default:(0,a.w5)((()=>[U])),_:1},8,["modelValue"])],64)}}};const B=H;var z=B},4579:function(e,t,n){n.d(t,{H:function(){return a},X:function(){return i}});const a=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InvalidShortString",type:"error"},{inputs:[],name:"ReentrancyGuardReentrantCall",type:"error"},{inputs:[{internalType:"string",name:"str",type:"string"}],name:"StringTooLong",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"CancelAllInscriptionOrder",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"bytes32",name:"orderHash",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"inscriptionId",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"CancelInscriptionOrder",type:"event"},{anonymous:!1,inputs:[],name:"EIP712DomainChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"orderHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"orderNonce",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"inscriptionId",type:"bytes32"},{indexed:!1,internalType:"address",name:"caller",type:"address"},{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"address",name:"buyer",type:"address"},{indexed:!1,internalType:"uint256",name:"price",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"InscriptionOrderExecuted",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"address",name:"recipient",type:"address"},{indexed:!1,internalType:"bytes32",name:"inscriptionId",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"InscriptionTransferGo",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{stateMutability:"nonpayable",type:"fallback"},{inputs:[],name:"cancelAllOrders",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"signer",type:"address"},{internalType:"bytes32",name:"inscriptionId",type:"bytes32"},{internalType:"uint256",name:"price",type:"uint256"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint64",name:"startedAt",type:"uint64"},{internalType:"uint64",name:"expiredAt",type:"uint64"},{internalType:"bytes",name:"signature",type:"bytes"}],internalType:"struct OrderTypes.InscriptionOrder",name:"order",type:"tuple"}],name:"cancelOrder",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"eip712Domain",outputs:[{internalType:"bytes1",name:"fields",type:"bytes1"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"version",type:"string"},{internalType:"uint256",name:"chainId",type:"uint256"},{internalType:"address",name:"verifyingContract",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"uint256[]",name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"signer",type:"address"},{internalType:"bytes32",name:"inscriptionId",type:"bytes32"},{internalType:"uint256",name:"price",type:"uint256"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint64",name:"startedAt",type:"uint64"},{internalType:"uint64",name:"expiredAt",type:"uint64"},{internalType:"bytes",name:"signature",type:"bytes"}],internalType:"struct OrderTypes.InscriptionOrder",name:"order",type:"tuple"},{internalType:"address",name:"recipient",type:"address"}],name:"executeInscriptionOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"uint256",name:"orderNonce",type:"uint256"}],name:"isUserOrderNonceExecutedOrCancelled",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolFeeBps",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolFeeRecipient",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"_protocolFeeBps",type:"uint16"}],name:"updateProtocolFeeBps",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"userMinOrderNonce",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address payable",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawETH",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],i="0x74a73f873876a17b9B8BB623B44023c4CE759C2C"}}]);
//# sourceMappingURL=263.03d4d239.js.map